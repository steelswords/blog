<!doctype html><html data-theme=dark lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://tristanandrus.com name=base><title>Tristan Andrus â€¢ Let's Build a Cross Compiler!</title><link href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 105 55"><text y=".7em" font-size="82">ðŸ’»</text></svg>' rel=icon><link title="Tristan Andrus - Atom Feed" href=https://tristanandrus.com/atom.xml rel=alternate type=application/atom+xml><link href="https://tristanandrus.com/spoilersection.css?h=a8f027ae57acf043de52" rel=stylesheet><link href="https://tristanandrus.com/attributedblockquote.css?h=1b96ca8639a3c4a94489" rel=stylesheet><link href="https://tristanandrus.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://tristanandrus.com/main.css?h=4a3dff148c520f191505" rel=stylesheet><meta content=dark name=color-scheme><meta content="I build a cross compiler for the Raspberry Pi Zero W with Crosstool-ng" name=description><meta content="I build a cross compiler for the Raspberry Pi Zero W with Crosstool-ng" property=og:description><meta content="index, nofollow" name=robots><meta content="Let's Build a Cross Compiler!" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://tristanandrus.com/blog/lets-build-a-cross-compiler/ property=og:url><meta content="Tristan Andrus" property=og:site_name><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><script defer src=https://tristanandrus.com/js/toggle_spoiler.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://tristanandrus.com>Tristan Andrus</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/experience/> experience </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/blog/> blog </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/tags/> tags </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/archive/> archive </a></li><div class=nav-navs id=menu-icons-group></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Let's Build a Cross Compiler!</h1><ul class=meta><li>2nd Jul 2023<li title="688 words"><span aria-hidden=true class=separator>â€¢</span>4 min read<li class=tag><span aria-hidden=true class=separator>â€¢</span>Tags:Â <li class=tag><a href=https://tristanandrus.com/tags/linux/>linux</a></ul><section class=body><h1 id=creating-a-cross-compiler-for-an-arm-target><a aria-label="Anchor link for: creating-a-cross-compiler-for-an-arm-target" class="header-anchor no-hover-padding" href=#creating-a-cross-compiler-for-an-arm-target><span aria-hidden=true class=link-icon></span></a> Creating a Cross Compiler for an ARM target</h1><p>I want to learn more about cross compiling. I'm familiar with the concept, I've done my fair share as an embedded developer, but most of the time I just use a pre-generated toolchain from Yocto or a microcontroller SDK.I've even built a cross-compiler for my operating system project before, but that was just following the tutorial on the OSDev Wiki.<p>So how do I make a cross compiler for pleasure and profit?<p>For this project, I'm using my trusty Raspberry Pi Zero W. This is for a couple of reasons.<p>First, I recently wanted to cross-compile for the Zero W and could not find a toolchain that would work for me. I found a precompiled one, but it had the wrong version of glibc included or something.<p>Second, it's a less-mainstream ARM target. Most of the help I've seen on the Interwebs for cross-compiling to Pis is for the Pi 3 or Pi 4. And they're using a different architecture version than the Pi Zero.<p>Which brings me to this project. How do I create a cross-compiler toolchain for the Pi Zero W, which a specific glibc version? And more generally, how can I create a cross compiler for an arbitrary platform? That, more than anything, is the real key takeaway I'm after.<p>I konw I can set the right flags for the target arch and whether to use hard or soft floats, etc., etc. and build binutils, glibc, and gcc from scratch, but that sounds really onerous. Is there some other way?<h1 id=enter-crosstool-ng><a aria-label="Anchor link for: enter-crosstool-ng" class="header-anchor no-hover-padding" href=#enter-crosstool-ng><span aria-hidden=true class=link-icon></span></a> Enter Crosstool-ng.</h1><p>Crosstool-ng is a nifty set of scripts designed to make downloading and building the right binutils, libc, and compiler source easy peasy. And boy, does it deliver. I was able to go from no experience to making a toolchain for my Raspberry Pi Zero W in under an hour while watching a movie. (Home tinkerers will likely know what I mean about a movie-watching productivity hit.)<h1 id=configuring-crosstool-ng><a aria-label="Anchor link for: configuring-crosstool-ng" class="header-anchor no-hover-padding" href=#configuring-crosstool-ng><span aria-hidden=true class=link-icon></span></a> Configuring Crosstool-ng</h1><p>There are a few config options we need to set to tell crosstool-ng to build the right thing.<p>The target architecture is of course arm. But what about the instruction set mode? Is it <code>arm</code> or <code>thumb</code>? I think there will be many such details I don't know off the top of my head. Let's find the datasheet for the CPU. I found on the Raspberry Pi website that the Pi Zero W uses a Broadcom BCM2835 chip, which contains a single-core ARM1176JZF-S processor. Let's look at the datasheet for the ARM1176JZF-S.<p>K, it supports arm and thumb instructions, so let's go with arm.<p>There were some other config parameters I set. Most of them were obvious to me, so I didn't record them (unfortunate for those 100% of other people who think differently from me, I do apologize). But some of the config items were kind of like a treasure hunt. For reference, I've recorded the trickiest items, where I found the right value, and what it was for the Pi Zero W here:<table><thead><tr><th>Config parameter<th>Where I found the answer<th>Answer<tbody><tr><td>architecture level: <code>CT_ARCH_ARCH</code><td><code>gcc -v</code><td>armv6<tr><td>glibc version<td><code>ldd --version</code><td>2.31-13<tr><td>Various FPU options<td><code>gcc -v</code><td>hard float, hardware float throughout</table><p>Alright, with those set, we're ready to build the toolchain!<h1 id=building-the-toolchain><a aria-label="Anchor link for: building-the-toolchain" class="header-anchor no-hover-padding" href=#building-the-toolchain><span aria-hidden=true class=link-icon></span></a> Building the Toolchain</h1><p>With the config values all set to the proper values (hopefully!), it was time to save my configuration, copy it to <code>.config</code>, and run <code>ct-ng build.10</code><p>After about 15-20 minutes, crosstool-ng had downloaded the specified versions of everything it needed and built a complete compiler and toolchain for me!<p>Using that toolchain, I compiled my <code>hello.c</code> program and <code>scp</code>ed it to my pi zero. Hey presto! It works!<h1 id=conclusion><a aria-label="Anchor link for: conclusion" class="header-anchor no-hover-padding" href=#conclusion><span aria-hidden=true class=link-icon></span></a> Conclusion</h1><p>In the future, if I ever need to make a cross compiler, I'm going to build it with crosstool-ng. There is no reason not to, and it made the whole process super easy, clean, and reproducible. Three wonderful things to see in the mess of complexity that is computer programming.</section></article></main><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://tristanandrus.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://tristanandrus.com/atom.xml rel=noopener target=_blank> <img alt=feed loading=lazy src=https://tristanandrus.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://github.com/steelswords/ target=_blank> <img alt=github loading=lazy src=https://tristanandrus.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://www.linkedin.com/in/tristan-andrus target=_blank> <img alt=linkedin loading=lazy src=https://tristanandrus.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://fosstodon.org/@steelswords target=_blank> <img alt=mastodon loading=lazy src=https://tristanandrus.com/social_icons/mastodon.svg title=mastodon> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://bsky.app/profile/steelswords.bsky.social target=_blank> <img alt=bluesky loading=lazy src=https://tristanandrus.com/social_icons/bluesky.svg title=bluesky> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> Powered by <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi rel=noopener target=_blank>tabi</a> </small></div></section></footer>