<!doctype html><html data-theme=dark lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1.0" name=viewport><meta content=https://tristanandrus.com name=base><title>Tristan Andrus â€¢ Zigbee Lights Hack</title><link href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 105 55"><text y=".7em" font-size="82">ðŸ’»</text></svg>' rel=icon><link title="Tristan Andrus - Atom Feed" href=https://tristanandrus.com/atom.xml rel=alternate type=application/atom+xml><link href="https://tristanandrus.com/spoilersection.css?h=a8f027ae57acf043de52" rel=stylesheet><link href="https://tristanandrus.com/attributedblockquote.css?h=1b96ca8639a3c4a94489" rel=stylesheet><link href="https://tristanandrus.com/custom_subset.css?h=0b9535a28bc3d5bf2321" rel=stylesheet><link href="https://tristanandrus.com/main.css?h=4a3dff148c520f191505" rel=stylesheet><meta content=dark name=color-scheme><meta content="My efforts to control fluorescent lights with an Aduro Zigbee light bulb" name=description><meta content="My efforts to control fluorescent lights with an Aduro Zigbee light bulb" property=og:description><meta content="index, nofollow" name=robots><meta content="Zigbee Lights Hack" property=og:title><meta content=article property=og:type><meta content=en_GB property=og:locale><meta content=https://tristanandrus.com/blog/zigbee-lights-hack/ property=og:url><meta content="Tristan Andrus" property=og:site_name><meta content="default-src 'self';font-src 'self' data:;img-src 'self' https://* data:;style-src 'self';frame-src player.vimeo.com https://www.youtube-nocookie.com;connect-src 'self';script-src 'self' 'self'" http-equiv=Content-Security-Policy><script defer src=https://tristanandrus.com/js/toggle_spoiler.js></script><body><header><nav class=navbar><div class=nav-title><a class=home-title href=https://tristanandrus.com>Tristan Andrus</a></div><div class=nav-navs><ul><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/experience/> experience </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/blog/> blog </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/tags/> tags </a><li><a class="nav-links no-hover-padding" href=https://tristanandrus.com/archive/> archive </a></li><div class=nav-navs id=menu-icons-group></div></ul></div></nav></header><div class=content><main><article><h1 class=article-title>Zigbee Lights Hack</h1><ul class=meta><li>13th Apr 2024<li title="547 words"><span aria-hidden=true class=separator>â€¢</span>3 min read<li class=tag><span aria-hidden=true class=separator>â€¢</span>Tags:Â <li class=tag><a href=https://tristanandrus.com/tags/electronics/>electronics</a>,Â <li class=tag><a href=https://tristanandrus.com/tags/projects/>projects</a>,Â <li class=tag><a href=https://tristanandrus.com/tags/hardware/>hardware</a></ul><section class=body><h1 id=hacking-a-zigbee-lightbulb><a aria-label="Anchor link for: hacking-a-zigbee-lightbulb" class="header-anchor no-hover-padding" href=#hacking-a-zigbee-lightbulb><span aria-hidden=true class=link-icon></span></a> Hacking a Zigbee Lightbulb</h1><p>I have some smart lights installed in my house. They're great. You replace your regular light bulbs with Aduro Zigbee bulbs, put some Zigbee light switches over your existing ones, pair them all with your hub, and you're done.<p>You get native Zigbee grouping, which means your lights work offline, and you also get to control them from the Vivint app, which opens you up to all sorts of useful automations and such.<p>But the problem is the ecosystem I'm tied into doesn't support any in-wall Zigbee relays. So if you're trying to smartify a multigang lightswitch that also controls, say, ceiling fans or fluorescent bulbs, you're kind of out of luck. My ecosystem provides passthrough plates for their lightswitches, so you can still smartify some of the gangs and expose the physical switch on other gangs, so this wasn't a problem for a while. But I want my whole house smartified, darn it!<p>You can find Zigbee relays online for pretty cheap, but my ecosystem doesn't currently support Zigbee devices from outside its ecosystem. So what to do?<p>My solution was pretty clever, I thought. I would take the guts out of a supported Zigbee bulb, reverse engineer whatever signal the microcontroller was outputting to the LED control circuitry, and use that to turn a relay on/off.<p>Taking apart the bulb, I found that there was a PWM signal that corresponded to brightness, and boom! I'm off to the races.<p>I threw together a low pass filter for that PWM output, connected it to a transistor, added a flyback diode and a relay, and I had a working prototype!<h2 id=pcb-design><a aria-label="Anchor link for: pcb-design" class="header-anchor no-hover-padding" href=#pcb-design><span aria-hidden=true class=link-icon></span></a> PCB Design</h2><p>It took a little longer to design a PCB. Man, sourcing parts is just the least fun step of the whole process. Designing, testing, laying out the circuit? A blast. Finding parts and double checking their specs will line up with your design? Such a drag.<p>I found a nifty little module to give me 5V DC from mains power, the LS03-13B05R3. It was pretty cheap and even though the support caps took a fair bit of space and BOM cost, it's way smaller than my previous attempt at doing AC -> DC conversion.<p>After a few weeks, I had some cheap PCBs and was ready to start soldering!</p><img alt="The unpopulated PCB" class=dimmable-image height=1117 src=https://tristanandrus.com/img/articles/zigbee-lights/unpopped-pcb.jpg width=1624><h2 id=pcb-assembly><a aria-label="Anchor link for: pcb-assembly" class="header-anchor no-hover-padding" href=#pcb-assembly><span aria-hidden=true class=link-icon></span></a> PCB Assembly</h2><p>This was not my first time soldering SMT devices, but it was my first time soldering anthing smaller than a 1206. My old technique of using the iron the whole time and tacking down one end and then the other is just inadequate. You need to use tweezers and a hot air reflow for smaller components. There are presumably still some 0805 pieces in my office carpet that will remain til the end of time.<p>And here's the finished piece:</p><img alt="The unpopulated PCB" class=dimmable-image height=1117 src=https://tristanandrus.com/img/articles/zigbee-lights/unpopped-pcb.jpg width=1624><p>Time to test it out!<p>Here's my first mistake. I didn't do any sort of continuity sanity check when I first got the PCB. If I had, I might have realized that I had a pad reversed on the Zigbee daughterboard. Thankfully, it was a non-connected pad, but my goodness, what a terror!</section></article></main><span class=hidden id=copy-success> Copied! </span><span class=hidden id=copy-init> Copy code to clipboard </span><script defer src=https://tristanandrus.com/js/copyCodeToClipboard.min.js></script></div><footer><section><nav class="socials nav-navs"><ul><li><a class="nav-links no-hover-padding social" href=https://tristanandrus.com/atom.xml rel=noopener target=_blank> <img alt=feed loading=lazy src=https://tristanandrus.com/social_icons/rss.svg title=feed> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://github.com/steelswords/ target=_blank> <img alt=github loading=lazy src=https://tristanandrus.com/social_icons/github.svg title=github> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://www.linkedin.com/in/tristan-andrus target=_blank> <img alt=linkedin loading=lazy src=https://tristanandrus.com/social_icons/linkedin.svg title=linkedin> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://fosstodon.org/@steelswords target=_blank> <img alt=mastodon loading=lazy src=https://tristanandrus.com/social_icons/mastodon.svg title=mastodon> </a><li><a class="nav-links no-hover-padding social" rel="noopener me" href=https://bsky.app/profile/steelswords.bsky.social target=_blank> <img alt=bluesky loading=lazy src=https://tristanandrus.com/social_icons/bluesky.svg title=bluesky> </a></ul></nav><nav class=nav-navs></nav><div class=credits><small> Powered by <a href=https://www.getzola.org rel=noopener target=_blank>Zola</a> & <a href=https://github.com/welpo/tabi rel=noopener target=_blank>tabi</a> </small></div></section></footer>